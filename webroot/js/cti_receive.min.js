$(function(){var a=0;var d=new Array();var e=new EventSource($("#ctiReceiveUrl").val()+"?"+$("#citReceiveForm").serialize(),{withCredentials:true});e.onmessage=function(g){console.log("イベント発生中");var h="";h=jQuery.trim(g.data);if(h!=""){var f=JSON.parse(g.data);console.log("ダイアログ遅延:"+f.customer_code);d.push(tmp_id=setInterval(function(){b(f.customer_phone_number,f.customer_code,f.customer_postal_code,f.customer_address,f.customer_name,f.customer_memo,f.customer_chart_url,f.staff_name)},200))}else{}};e.onerror=function(f){if(e.readyState===0){console.log("エラーあり：接続中")}else{if(e.readyState===2){console.log("エラーあり：切断されている")}}};function b(h,k,m,j,g,f,l,i){if(a==0){c(h,k,m,j,g,f,l,i);if(d.length>0){clearInterval(d.shift())}return true}}function c(m,h,n,f,g,o,k,l){a=1;var j="";var i="発信者:"+g;var p="着信番号:"+m+"\n";p=p+"顧客CD:"+h+"\n";p=p+"住所:〒"+n+"\n";p=p+f+"\n";p=p+"メモ:"+o+"\n";p=p+"担当者:"+l+"\n";if(!("Notification" in window)){alert("このブラウザはシステム通知をサポートしていません")}else{if(Notification.permission==="granted"){j=new Notification(i,{icon:"/sas/img/tel.png",tag:h,body:p,lang:"utf-8"});console.log("ダイアログ表示？:"+h)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(q){if(q==="granted"){j=new Notification(i,{icon:"/sas/img/tel.png",tag:h,body:p,lang:"utf-8"});console.log("ダイアログ表示？:"+h)}})}}}if(j!==""){if(k!=""){j.addEventListener("click",function(){})}else{j.addEventListener("click",function(){this.close()})}j.addEventListener("show",function(){a=0});j.addEventListener("error",function(){})}}});