/*! wPaint - v2.5.0 - 2021-09-30 */
!function(p){"use strict";function a(t,e){this.$el=p(t),this.options=e,this.init=!1,this.menus={primary:null,active:null,all:{}},this.previousMode=null,this.width=this.$el.width(),this.height=this.$el.height(),this.ctxBgResize=!1,this.ctxResize=!1,this.generate(),this._init()}function i(t,e,i){this.wPaint=t,this.options=i,this.name=e,this.type=t.menus.primary?"secondary":"primary",this.docked=!0,this.dockOffset={left:0,top:0},this.generate()}a.prototype={generate:function(){if(this.init)return this;var n=this;function t(t){var e=t?t.capitalize():"",i="canvas"+e,e="ctx"+e;return n[i]=document.createElement("canvas"),n[e]=n[i].getContext("2d"),n["$"+i]=p(n[i]),n["$"+i].attr("class","wPaint-canvas"+(t?"-"+t:"")).attr("width",n.width+"px").attr("height",n.height+"px").css({position:"absolute",left:0,top:0}),n.$el.append(n["$"+i]),n["$"+i]}t("bg"),t("").on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),n.draw=!0,t.canvasEvent="down",n._closeSelectBoxes(),n._callShapeFunc.apply(n,[t])}).bindMobileEvents(),t("temp").hide(),p(document).on("mousemove",function(t){n.draw&&(t.canvasEvent="move",n._callShapeFunc.apply(n,[t]))}).on("mousedown",p.proxy(this._closeSelectBoxes,this)).on("mouseup",function(t){n.draw&&(n.draw=!1,t.canvasEvent="up",n._callShapeFunc.apply(n,[t]))}),this.setTheme(this.options.theme)},_init:function(){var t,e=null;for(e in this.init=!0,this.options)this[t="set"+e.capitalize()]&&this[t](this.options[e]);this._fixMenus(),this.menus.primary._getIcon(this.options.mode).trigger("click")},resize:function(){var t=this.getBg(),e=this.getImage();this.width=this.$el.width(),this.height=this.$el.height(),this.canvasBg.width=this.width,this.canvasBg.height=this.height,this.canvas.width=this.width,this.canvas.height=this.height,!1===this.ctxBgResize&&(this.ctxBgResize=!0,this.setBg(t,!0)),!1===this.ctxResize&&(this.ctxResize=!0,this.setImage(e,"",!0,!0))},resize2:function(t){1==t?this.ctx.scale(this.rate,this.rate):this.ctx.scale(1/t,1/t),this.width=this.$el.width(),this.height=this.$el.height(),this.rate=t},setTheme:function(t){var e,i;for(t=t.split(" "),this.$el.attr("class",(this.$el.attr("class")||"").replace(/wPaint-theme-.+\s|wPaint-theme-.+$/,"")),e=0,i=t.length;e<i;e++)this.$el.addClass("wPaint-theme-"+t[e])},setMode:function(t){this.setCursor(t),this.previousMode=this.options.mode,this.options.mode=t},setImage:function(t,o,h,r){if(!t)return!0;var c=this,l=null,u="";o="ctx"+(o||"").capitalize(),u=this[o],window.rgbHex(t)?(u.clearRect(0,0,this.width*this.rate,this.height*this.rate),u.fillStyle=t,u.rect(0,0,this.width*this.rate,this.height*this.rate),u.fill()):((l=new Image).src=t.toString(),p(l).load(function(){l.width<c.width&&(l.width=l.width*c.rate,l.height=l.height*c.rate);var t,e,i=0,n=0,s=l.width,a=l.height;h||((l.width>c.width||l.height>c.height||c.options.imageStretch)&&(t=c.width/l.width,e=c.height/l.height,s=l.width*(e=t<e?t:e),a=l.height*e),i=(c.width-s)/2,n=(c.height-a)/2),u.clearRect(0,0,c.width,c.height),u.drawImage(l,i,n,s,a),c[o+"Resize"]=!1,r||c._addUndo()}))},setBg:function(t,e){if(!t)return!0;this.setImage(t,"bg",e,!0)},setCursor:function(t){t=p.fn.wPaint.cursors[t]||p.fn.wPaint.cursors.default,this.$el.css("cursor",'url("'+this.options.path+t.path+'") '+t.left+" "+t.top+", default")},setMenuOrientation:function(i){p.each(this.menus.all,function(t,e){e.options.aligment=i,e.setAlignment(i)})},getImage:function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return t=!1!==t,p(e).css({display:"none",position:"absolute",left:0,top:0}).attr("width",this.width/this.rate).attr("height",this.height/this.rate),t&&i.drawImage(this.canvasBg,0,0),i.drawImage(this.canvas,0,0),e.toDataURL()},getBg:function(){return this.canvasBg.toDataURL()},getImageWithoutBg:function(){return this.getImage(!1)},resetUndo:function(){this.undoCurrent=-1,this.undoArray=[],this._undoToggleIcons()},_displayStatus:function(t){var e=this;this.$status||(this.$status=p('<div class="wPaint-status"></div>'),this.$el.append(this.$status)),this.$status.html(t),clearTimeout(this.displayStatusTimer),this.$status.fadeIn(500,function(){e.displayStatusTimer=setTimeout(function(){e.$status.fadeOut(500)},1500)})},_showModal:function(t){var e=this,i=this.$el.children(".wPaint-modal-bg"),n=this.$el.children(".wPaint-modal");i.length?n.fadeOut(500,function(){i.remove(),n.remove(),e._createModal(t)}):this._createModal(t)},_createModal:function(t){t=p('<div class="wPaint-modal-content"></div>').append(t.children());var e=p('<div class="wPaint-modal-bg"></div>'),i=p('<div class="wPaint-modal"></div>'),n=p('<div class="wPaint-modal-holder"></div>'),s=p('<div class="wPaint-modal-close">X</div>');function a(){e.remove(),i.remove()}s.on("click",function(){i.fadeOut(500,a)}),i.append(n.append(t)).append(s),this.$el.append(e).append(i),i.css({left:this.$el.outerWidth()/2-i.outerWidth(!0)/2,top:this.$el.outerHeight()/2-i.outerHeight(!0)/2}),i.fadeIn(500)},_createMenu:function(t,e){return(e=e||{}).alignment=this.options.menuOrientation,e.handle=this.options.menuHandle,new i(this,t,e)},_fixMenus:function(){var t,n=this,e=null;function i(t,e){var i=p(e),e=i.clone();e.appendTo(n.$el),e.outerHeight()===e.get(0).scrollHeight&&i.css({overflowY:"auto"}),e.remove()}for(t in this.menus.all)(e=n.menus.all[t].$menu.find(".wPaint-menu-select-holder")).length&&e.children().each(i)},_closeSelectBoxes:function(t){var e,i;for(e in this.menus.all)i=this.menus.all[e].$menuHolder.children(".wPaint-menu-icon-select"),(i=t?i.not(".wPaint-menu-icon-name-"+t.name):i).children(".wPaint-menu-select-holder").hide()},_callShapeFunc:function(t){var e=this.$canvas.offset(),i=t.canvasEvent.capitalize(),n="_draw"+this.options.mode.capitalize()+i;t.pageX=Math.floor(t.pageX-e.left),t.pageY=Math.floor(t.pageY-e.top),this[n]&&("_drawPencilDown"==n?this[n].apply(this,[t,this.options]):this[n].apply(this,[t])),this.options["draw"+i]&&this.options["_draw"+i].apply(this,[t]),"Down"===i&&this.options.onShapeDown?this.options.onShapeDown.apply(this,[t]):"Move"===i&&this.options.onShapeMove?this.options.onShapeMove.apply(this,[t]):"Up"===i&&this.options.onShapeUp&&this.options.onShapeUp.apply(this,[t])},_stopPropagation:function(t){t.stopPropagation()},_drawShapeDown:function(t){this.$canvasTemp.css({left:t.PageX,top:t.PageY}).attr("width",0).attr("height",0).show(),this.canvasTempLeftOriginal=t.pageX,this.canvasTempTopOriginal=t.pageY},_drawShapeMove:function(t,e){var i=this.canvasTempLeftOriginal,n=this.canvasTempTopOriginal,s=Math.round(this.options.lineWidth*this.rate);e=e||2,t.left=t.pageX<i?t.pageX:i,t.top=t.pageY<n?t.pageY:n,t.width=Math.abs(t.pageX-i),t.height=Math.abs(t.pageY-n),t.x=s/2*e+.2/this.rate,t.y=s/2*e+.2/this.rate,t.w=t.width-s*e,t.h=t.height-s*e,p(this.canvasTemp).css({left:t.left,top:t.top,width:t.width,height:t.height}).attr("width",t.width).attr("height",t.height),this.canvasTempLeftNew=t.left,this.canvasTempTopNew=t.top,e=e||2,this.ctxTemp.fillStyle=this.options.fillStyle,this.ctxTemp.strokeStyle=this.options.strokeStyle,this.ctxTemp.lineWidth=s*e},_drawShapeUp:function(){if(0<this.canvasTemp.clientHeight&&0<this.canvasTemp.clientWidth&&0<this.canvasTempLeftNew&&0<this.canvasTempTopNew)try{this.ctx.drawImage(this.canvasTemp,this.canvasTempLeftNew,this.canvasTempTopNew),this.$canvasTemp.hide()}catch(t){}},_drawDropperDown:function(t){var e={x:t.pageX,y:t.pageY},t=this._getPixel(this.ctx,e),e="rgba("+[t.r,t.g,t.b,t.a].join(",")+")";this.options[this.dropper]=e,this.menus.active._getIcon(this.dropper).wColorPicker("color",e)},_drawDropperUp:function(){this.setMode(this.previousMode)},_getPixel:function(t,e){var i=t.getImageData(0,0,this.width,this.height),t=i.data,e=4*(e.y*i.width+e.x);return{r:t[e],g:t[1+e],b:t[2+e],a:t[3+e]}}},i.prototype={generate:function(){this.$menu=p('<div class="wPaint-menu"></div>'),this.$menuHolder=p('<div class="wPaint-menu-holder wPaint-menu-name-'+this.name+'"></div>'),this.options.handle?this.$menuHandle=this._createHandle():this.$menu.addClass("wPaint-menu-nohandle"),"primary"===this.type?((this.wPaint.menus.primary=this).setOffsetLeft(this.options.offsetLeft),this.setOffsetTop(this.options.offsetTop)):"secondary"===this.type&&this.$menu.hide(),this.$menu.append(this.$menuHolder.append(this.$menuHandle)),this.reset(),this.wPaint.$el.append(this.$menu),this.setAlignment(this.options.alignment)},reset:function(){var t,e,i=this,n=p.fn.wPaint.menus[this.name];for(t in n.items)this.$menuHolder.children(".wPaint-menu-icon-name-"+t).length||(n.items[t].name=t,n.items[t].img=i.wPaint.options.path+(n.items[t].img||n.img),e=n.items[t],i._appendItem(e))},_appendItem:function(t){var e=this["_createIcon"+t.icon.capitalize()](t);t.after?this.$menuHolder.children(".wPaint-menu-icon-name-"+t.after).after(e):this.$menuHolder.append(e)},setOffsetLeft:function(t){this.$menu.css({left:t})},setOffsetTop:function(t){this.$menu.css({top:t})},setAlignment:function(t){this.$menu.css("left");this.$menu.attr("class",this.$menu.attr("class").replace(/wPaint-menu-alignment-.+\s|wPaint-menu-alignment-.+$/,"")),this.$menu.addClass("wPaint-menu-alignment-"+t),"secondary"===this.type&&("horizontal"===this.options.alignment?this.dockOffset.top=this.wPaint.menus.primary.$menu.outerHeight(!0):this.dockOffset.left=this.wPaint.menus.primary.$menu.outerWidth(!0))},_createHandle:function(){var s=this,t=p('<div class="wPaint-menu-handle"></div>');return this.$menu.draggable({handle:t}),"secondary"===this.type&&(this.$menu.draggable("option","snap",this.wPaint.menus.primary.$menu),this.$menu.draggable("option","start",function(){s.docked=!1,s._setDrag()}),this.$menu.draggable("option","stop",function(){p.each(s.$menu.data("ui-draggable").snapElements,function(t,e){var i=s.$menu.offset(),n=s.wPaint.menus.primary.$menu.offset();s.dockOffset.left=i.left-n.left,s.dockOffset.top=i.top-n.top,s.docked=e.snapping}),s._setDrag()}),this.$menu.draggable("option","drag",function(){s._setIndex()})),t.bindMobileEvents(),t},_createIconBase:function(t){var e=this,i=p('<div class="wPaint-menu-icon wPaint-menu-icon-name-'+t.name+'"></div>'),n=p('<div class="wPaint-menu-icon-img"></div>'),s=n.realWidth(null,null,this.wPaint.$el);return i.attr("title",t.title).on("mousedown",p.proxy(this.wPaint._closeSelectBoxes,this.wPaint,t)).on("mouseenter",function(t){(t=p(t.currentTarget)).siblings(".hover").removeClass("hover"),t.hasClass("disabled")||t.addClass("hover")}).on("mouseleave",function(t){p(t.currentTarget).removeClass("hover")}).on("click",function(){e.wPaint.menus.active=e}),p.isNumeric(t.index)&&n.css({backgroundImage:"url("+t.img+")",backgroundPosition:-s*t.index+"px 0px"}),i.append(n)},_createIconGroup:function(t){var e,i,n,s=this,a={backgroundImage:"url("+t.img+")"},o=this.$menuHolder.children(".wPaint-menu-icon-group-"+t.group),h=o.length,r=null;function c(){o.children(".wPaint-menu-select-holder").is(":visible")||t.callback.apply(s.wPaint,[])}if(n=(o=!h?this._createIconBase(t).addClass("wPaint-menu-icon-group wPaint-menu-icon-group-"+t.group).on("click.setIcon",c).on("mousedown",p.proxy(this._iconClick,this)):o).children(".wPaint-menu-icon-img").realWidth(null,null,this.wPaint.$el),a.backgroundPosition=-n*t.index+"px center",(r=o.children(".wPaint-menu-select-holder")).length||(r=this._createSelectBox(o)).children().on("click",function(){o.addClass("active").siblings(".active").removeClass("active")}),i=p('<div class="wPaint-menu-icon-select-img"></div>').attr("title",t.title).css(a),e=this._createSelectOption(r,i).addClass("wPaint-menu-icon-name-"+t.name).on("click",function(){o.attr("title",t.title).off("click.setIcon").on("click.setIcon",c),o.children(".wPaint-menu-icon-img").css(a),t.callback.apply(s.wPaint,[])}),t.after&&r.children(".wPaint-menu-select").children(".wPaint-menu-icon-name-"+t.after).after(e),!h)return o},_createIconGeneric:function(t){return this._createIconActivate(t)},_createIconActivate:function(e){if(e.group)return this._createIconGroup(e);var i=this,t=this._createIconBase(e);return t.on("click",function(t){"generic"!==e.icon&&i._iconClick(t),e.callback.apply(i.wPaint,[t])}),t},_isIconDisabled:function(t){return this.$menuHolder.children(".wPaint-menu-icon-name-"+t).hasClass("disabled")},_setIconDisabled:function(t,e){t=this.$menuHolder.children(".wPaint-menu-icon-name-"+t);e?t.addClass("disabled").removeClass("hover"):t.removeClass("disabled")},_getIcon:function(t){return this.$menuHolder.children(".wPaint-menu-icon-name-"+t)},_iconClick:function(t){var e,t=p(t.currentTarget),i=this.wPaint.menus.all;for(e in i)i[e]&&"secondary"===i[e].type&&i[e].$menu.hide();t.siblings(".active").removeClass("active"),t.hasClass("disabled")||t.addClass("active")},_createIconToggle:function(t){var e=this,i=this._createIconBase(t);return i.on("click",function(){i.toggleClass("active"),t.callback.apply(e.wPaint,[i.hasClass("active")])}),i},_createIconSelect:function(e){var t,i,n,s=this,a=this._createIconBase(e),o=this._createSelectBox(a);function h(t){a.children(".wPaint-menu-icon-img").html(p(t.currentTarget).html()),e.callback.apply(s.wPaint,[p(t.currentTarget).html()])}for(t=0,i=e.range.length;t<i;t++)(n=this._createSelectOption(o,e.range[t])).on("click",h),e.useRange&&n.css(e.name,e.range[t]);return a},_createSelectBox:function(t){var e=p('<div class="wPaint-menu-select-holder"></div>'),i=p('<div class="wPaint-menu-select"></div>'),n=null;return e.on("mousedown mouseup",this.wPaint._stopPropagation).on("click",function(t){t.stopPropagation(),e.hide()}).hide(),"horizontal"===this.options.alignment?e.css({left:0,top:t.children(".wPaint-menu-icon-img").realHeight("outer",!0,this.wPaint.$el)}):e.css({left:t.children(".wPaint-menu-icon-img").realWidth("outer",!0,this.wPaint.$el),top:0}),t.addClass("wPaint-menu-icon-select").append('<div class="wPaint-menu-icon-group-arrow"></div>').append(e.append(i)),t.hasClass("wPaint-menu-icon-group")?t.on("mousedown",function(){n=setTimeout(function(){e.toggle()},200)}).on("mouseup",function(){clearTimeout(n)}):t.on("click",function(){e.toggle()}),e},_createSelectOption:function(t,e){t=t.children(".wPaint-menu-select"),e=p('<div class="wPaint-menu-select-option"></div>').append(e);return t.children().length||e.addClass("first"),t.append(e),e},_setSelectValue:function(t,e){this._getIcon(t).children(".wPaint-menu-icon-img").html(e)},_createIconColorPicker:function(e){var i=this,t=this._createIconBase(e);return t.on("click",function(){"dropper"===i.wPaint.options.mode&&i.wPaint.setMode(i.wPaint.previousMode)}).addClass("wPaint-menu-colorpicker").wColorPicker({position:"br",mode:"click",generateButton:!1,dropperButton:!0,onSelect:function(t){e.callback.apply(i.wPaint,[t])},onDropper:function(){t.trigger("click"),i.wPaint.dropper=e.name,i.wPaint.setMode("dropper")}}),t},_setColorPickerValue:function(t,e){this._getIcon(t).children(".wPaint-menu-icon-img").css("backgroundColor",e)},_createIconMenu:function(e){var i=this,t=this._createIconActivate(e);return t.on("click",function(){i.wPaint.setCursor(e.name);var t=i.wPaint.menus.all[e.name];t.$menu.toggle(),i.handle?t._setDrag():t._setPosition()}),t},_setDrag:function(){var t=null,e=null;this.$menu.is(":visible")&&(this.docked&&(t=e=p.proxy(this._setPosition,this),this._setPosition()),this.wPaint.menus.primary.$menu.draggable("option","drag",t),this.wPaint.menus.primary.$menu.draggable("option","stop",e))},_setPosition:function(){var t=this.wPaint.menus.primary.$menu.position();this.$menu.css({left:t.left+this.dockOffset.left,top:t.top+this.dockOffset.top})},_setIndex:function(){var t=this.wPaint.menus.primary.$menu.offset(),e=this.$menu.offset();e.top<t.top||e.left<t.left?this.$menu.addClass("wPaint-menu-behind"):this.$menu.removeClass("wPaint-menu-behind")}},p.support.canvas=document.createElement("canvas").getContext,p.fn.wPaint=function(e,i){function t(){var t=p.data(this,"wPaint");return t||(t=new a(this,p.extend(!0,{},e)),p.data(this,"wPaint",t)),t}if("string"!=typeof e)return(e=p.extend({},p.fn.wPaint.defaults,e)).lineWidth=parseInt(e.lineWidth,10),e.fontSize=parseInt(e.fontSize,10),this.each(function(){return p.support.canvas?p.proxy(t,this)():(p(this).html("Browser does not support HTML5 canvas, please upgrade to a more modern browser."),!1)});var n=[],s=(i?"set":"get")+e.charAt(0).toUpperCase()+e.substring(1);return this.each(function(){var t=p.data(this,"wPaint");t&&(t[e]?t[e].apply(t,[i]):void 0!==i?(t[s]&&t[s].apply(t,[i]),t.options[e]&&(t.options[e]=i)):t[s]?n.push(t[s].apply(t,[i])):t.options[e]?n.push(t.options[e]):n.push(void 0))}),n.length?1===n.length?n[0]:n:this},p.fn.wPaint.extend=function(n,s){for(var t in s=("menu"===s?i:a).prototype,n)!function(t){var e,i;s[t]?(e=a.prototype[t],i=n[t],s[t]=function(){e.apply(this,arguments),i.apply(this,arguments)}):s[t]=n[t]}(t)},p.fn.wPaint.menus={},p.fn.wPaint.cursors={},p.fn.wPaint.defaults={path:"/",theme:"standard classic",autoScaleImage:!0,autoCenterImage:!0,menuHandle:!0,menuOrientation:"horizontal",menuOffsetLeft:5,menuOffsetTop:5,bg:null,image:null,imageStretch:!1,onShapeDown:null,onShapeMove:null,onShapeUp:null,rate:1}}(jQuery),String.prototype.capitalize||(String.prototype.capitalize=function(){return this.slice(0,1).toUpperCase()+this.slice(1)}),function(o){o.fn.realWidth=function(t,e,i){var n,s=null,a=""===(t="inner"===t||"outer"===t?t:"")?"width":t+"Width";return e=!0===e,s=o(this).clone().css({position:"absolute",left:-1e4}).appendTo(i||"body"),n=e?s[a](e):s[a](),s.remove(),n},o.fn.realHeight=function(t,e,i){var n,s=null,a=""===(t="inner"===t||"outer"===t?t:"")?"height":t+"Height";return e=!0===e,s=o(this).clone().css({position:"absolute",left:-1e4}).appendTo(i||"body"),n=e?s[a](e):s[a](),s.remove(),n},o.fn.bindMobileEvents=function(){o(this).on("touchstart touchmove touchend touchcancel",function(){var t=(event.changedTouches||event.originalEvent.targetTouches)[0],e="";switch(event.type){case"touchstart":e="mousedown";break;case"touchmove":e="mousemove",event.preventDefault();break;case"touchend":e="mouseup";break;default:return}var i=document.createEvent("MouseEvent");i.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(i)})}}(jQuery);